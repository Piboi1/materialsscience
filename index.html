<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Materials Science Interactive Models</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
.header { display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
.header button { padding: 10px 20px; cursor: pointer; margin-bottom: 5px; }
.model-container { display: none; margin-top: 20px; }
.active { display: block; }
label { margin-right: 10px; }
</style>
</head>
<body>
<h1>Materials Science Interactive Models</h1>
<div class="header">
  <button onclick="showModel('dislocation')">3D Dislocations</button>
  <button onclick="showModel('grain')">2D Grain Boundary</button>
  <button onclick="showModel('fcc')">FCC</button>
  <button onclick="showModel('bcc')">BCC</button>
  <button onclick="showModel('hcp')">HCP</button>
  <button onclick="showModel('sc')">SC</button>
  <button onclick="showModel('vacancy')">Vacancy</button>
  <button onclick="showModel('interstitial')">Interstitial</button>
  <button onclick="showModel('impurity')">Impurity</button>
  <button onclick="showModel('frenkel')">Frenkel Defect</button>
  <button onclick="showModel('schottky')">Schottky Defect</button>
</div>

<!-- 3D Dislocation Model -->
<div id="dislocation" class="model-container active">
<h2>3D Crystal Block: Edge vs Screw Dislocation</h2>
<label for="dislocationType">Dislocation Type:</label>
<select id="dislocationType">
  <option value="Edge">Edge</option>
  <option value="Screw">Screw</option>
</select>
<label for="dislocationPosition">Dislocation X Position:</label>
<input type="range" id="dislocationPosition" min="2" max="18" step="0.1" value="10">
<div id="dislocationPlot" style="width:90%;max-width:900px;height:600px;margin-top:20px;"></div>
</div>

<!-- 2D Grain Boundary Model -->
<div id="grain" class="model-container">
<h2>2D Grain Boundary Model</h2>
<label for="angle">Grain Misorientation Angle (degrees):</label>
<input type="range" id="angle" min="0" max="45" step="1" value="15">
<div id="grainPlot" style="width:90%;max-width:900px;height:600px;margin-top:20px;"></div>
</div>

<!-- FCC Crystal -->
<div id="fcc" class="model-container">
<h2>Face-Centered Cubic (FCC)</h2>
<p>Atoms at 8 corners + 6 face centers. Packing efficiency 74%. Examples: Copper, Aluminum, Gold.</p>
<div id="fccPlot" style="width:90%;max-width:600px;height:500px;margin-top:20px;"></div>
</div>

<!-- BCC Crystal -->
<div id="bcc" class="model-container">
<h2>Body-Centered Cubic (BCC)</h2>
<p>Atoms at 8 corners + 1 center. Packing efficiency 68%. Example: Iron.</p>
<div id="bccPlot" style="width:90%;max-width:600px;height:500px;margin-top:20px;"></div>
</div>

<!-- HCP Crystal -->
<div id="hcp" class="model-container">
<h2>Hexagonal Close-Packed (HCP)</h2>
<p>ABAB layering pattern. Packing efficiency 74%. Examples: Zinc, Magnesium.</p>
<div id="hcpPlot" style="width:90%;max-width:600px;height:500px;margin-top:20px;"></div>
</div>

<!-- SC Crystal -->
<div id="sc" class="model-container">
<h2>Simple Cubic (SC)</h2>
<p>Atoms only at corners. Packing efficiency 52%. Very rare: Polonium.</p>
<div id="scPlot" style="width:90%;max-width:600px;height:500px;margin-top:20px;"></div>
</div>

<!-- Point Defects -->
<div id="vacancy" class="model-container">
<h2>Vacancy</h2>
<p>Missing atom – empty spot in lattice.</p>
<div id="vacancyPlot" style="width:90%;max-width:600px;height:500px;margin-top:20px;"></div>
</div>

<div id="interstitial" class="model-container">
<h2>Interstitial</h2>
<p>Extra atom squeezed into a gap.</p>
<div id="interstitialPlot" style="width:90%;max-width:600px;height:500px;margin-top:20px;"></div>
</div>

<div id="impurity" class="model-container">
<h2>Impurity</h2>
<p>Wrong type of atom in the structure.</p>
<div id="impurityPlot" style="width:90%;max-width:600px;height:500px;margin-top:20px;"></div>
</div>

<div id="frenkel" class="model-container">
<h2>Frenkel Defect</h2>
<p>An ion leaves its spot and moves into a gap nearby (ceramics).</p>
<div id="frenkelPlot" style="width:90%;max-width:600px;height:500px;margin-top:20px;"></div>
</div>

<div id="schottky" class="model-container">
<h2>Schottky Defect</h2>
<p>Pair of ions (positive + negative) missing to maintain charge balance (ceramics).</p>
<div id="schottkyPlot" style="width:90%;max-width:600px;height:500px;margin-top:20px;"></div>
</div>

<script>
// ---------------- Tab Function ----------------
function showModel(id) {
  document.querySelectorAll('.model-container').forEach(div => div.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// ---------------- 3D Dislocation Model ----------------
const nx=20,ny=10,nz=5,b=1.0;
function generateLattice(){
  let X=[],Y=[],Z=[];
  for(let k=0;k<nz;k++) for(let j=0;j<ny;j++) for(let i=0;i<nx;i++){X.push(i);Y.push(j);Z.push(k);}
  return {X,Y,Z};
}
function edgeDisplacement(X, dislocX){return X.map(xi=>(xi>=dislocX?b:0));}
function screwDisplacement(X, dislocX){return X.map(xi=>b/(2*Math.PI)*Math.atan(xi-dislocX));}
function updateDislocation(){
  const type=document.getElementById("dislocationType").value;
  const dislocX=parseFloat(document.getElementById("dislocationPosition").value);
  const lattice=generateLattice();
  let Z_new=(type==="Edge")?lattice.Z.map((zi,idx)=>zi+edgeDisplacement(lattice.X,dislocX)[idx]):
                              lattice.Z.map((zi,idx)=>zi+screwDisplacement(lattice.X,dislocX)[idx]);
  Plotly.newPlot('dislocationPlot',[{x:lattice.X,y:lattice.Y,z:Z_new,mode:'markers',type:'scatter3d',marker:{size:4,color:Z_new,colorscale:'Viridis'}}],
    {title:`${type} Dislocation at X=${dislocX.toFixed(2)}`,scene:{xaxis:{title:'X'},yaxis:{title:'Y'},zaxis:{title:'Z'}}});
}
document.getElementById("dislocationType").addEventListener("change", updateDislocation);
document.getElementById("dislocationPosition").addEventListener("input", updateDislocation);
updateDislocation();

// ---------------- 2D Grain Boundary Model ----------------
const nx_g=20,ny_g=20;
function generateGrains(angleDeg){
  const X=[],Y=[],Z=[],C=[];
  const angleRad=angleDeg*Math.PI/180;
  for(let i=0;i<nx_g;i++) for(let j=0;j<ny_g;j++){X.push(i);Y.push(j);Z.push(0);C.push(0);}
  for(let i=0;i<nx_g;i++) for(let j=0;j<ny_g;j++){
    const x_rot=i*Math.cos(angleRad)-j*Math.sin(angleRad)+nx_g/2;
    const y_rot=i*Math.sin(angleRad)+j*Math.cos(angleRad);
    X.push(x_rot); Y.push(y_rot); Z.push(0); C.push(1);
  }
  return {X,Y,Z,C};
}
function updateGrainBoundary(){
  const angle=parseFloat(document.getElementById("angle").value);
  const lattice=generateGrains(angle);
  Plotly.newPlot('grainPlot',[{x:lattice.X,y:lattice.Y,z:lattice.Z,mode:'markers',type:'scatter3d',marker:{size:4,color:lattice.C,colorscale:'Portland'}}],
    {title:`2D Grain Boundary at ${angle}° Misorientation`,scene:{xaxis:{title:'X'},yaxis:{title:'Y'},zaxis:{title:'Plane'}}});
}
document.getElementById("angle").addEventListener("input",updateGrainBoundary);
updateGrainBoundary();

// ---------------- Crystal Structures with Boxes/Spheres ----------------
function plotCubicWithBox(type,divId){
  const L=2;
  let X=[],Y=[],Z=[],linesX=[],linesY=[],linesZ=[];
  if(type==="SC"||type==="BCC"||type==="FCC"){
    // corners
    for(let i=0;i<=1;i++) for(let j=0;j<=1;j++) for(let k=0;k<=1;k++){X.push(i*L);Y.push(j*L);Z.push(k*L);}
    if(type==="BCC"){X.push(L/2);Y.push(L/2);Z.push(L/2);}
    if(type==="FCC"){
      X.push(L/2);Y.push(L/2);Z.push(0); X.push(L/2);Y.push(L/2);Z.push(L);
      X.push(L/2);Y.push(0);Z.push(L/2); X.push(L/2);Y.push(1);Z.push(L/2);
      X.push(0);Y.push(L/2);Z.push(L/2); X.push(1);Y.push(L/2);Z.push(L/2);
    }
    const corners=[[0,0,0],[L,0,0],[L,L,0],[0,L,0],[0,0,L],[L,0,L],[L,L,L],[0,L,L]];
    const edges=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]];
    edges.forEach(e=>{
      linesX.push(corners[e[0]][0],corners[e[1]][0],null);
      linesY.push(corners[e[0]][1],corners[e[1]][1],null);
      linesZ.push(corners[e[0]][2],corners[e[1]][2],null);
    });
    Plotly.newPlot(divId,[
      {x:X,y:Y,z:Z,type:'scatter3d',mode:'markers',marker:{size:6,color:'orange'}},
      {x:linesX,y:linesY,z:linesZ,type:'scatter3d',mode:'lines',line:{color:'black',width:2}}
    ],{title:type+' Unit Cell',scene:{xaxis:{title:'X'},yaxis:{title:'Y'},zaxis:{title:'Z'}}});
  } else if(type==="HCP"){
    const a=1,c=Math.sqrt(8/3);
    const layerA=[[0,0,0],[a,0,0],[a/2,a*Math.sqrt(3)/2,0]];
    const layerB=[[0,a*Math.sqrt(3)/3,c/2],[a,a*Math.sqrt(3)/3,c/2],[a/2,5*a*Math.sqrt(3)/6,c/2]];
    let X=[],Y=[],Z=[];
    layerA.forEach(v=>{X.push(v[0]);Y.push(v[1]);Z.push(v[2]);});
    layerB.forEach(v=>{X.push(v[0]);Y.push(v[1]);Z.push(v[2]);});
    const hexCorners=[[0,0,0],[a,0,0],[3*a/2,a*Math.sqrt(3)/2,0],[a,a*Math.sqrt(3),0],[0,a*Math.sqrt(3),0],[-a/2,a*Math.sqrt(3)/2,0]];
    const edges=[[0,1],[1,2],[2,3],[3,4],[4,5],[5,0]];
    let ex=[],ey=[],ez=[];
    edges.forEach(e=>{
      ex.push(hexCorners[e[0]][0],hexCorners[e[1]][0],null);
      ey.push(hexCorners[e[0]][1],hexCorners[e[1]][1],null);
      ez.push(hexCorners[e[0]][2],hexCorners[e[1]][2],null);
    });
    Plotly.newPlot(divId,[
      {x:X,y:Y,z:Z,type:'scatter3d',mode:'markers',marker:{size:6,color:'orange'}},
      {x:ex,y:ey,z:ez,type:'scatter3d',mode:'lines',line:{color:'black',width:2}}
    ],{title:type+' Unit Cell',scene:{xaxis:{title:'X'},yaxis:{title:'Y'},zaxis:{title:'Z'}}});
  }
}

plotCubicWithBox('FCC','fccPlot');
plotCubicWithBox('BCC','bccPlot');
plotCubicWithBox('HCP','hcpPlot');
plotCubicWithBox('SC','scPlot');

// ---------------- Point Defects ----------------
function plotPointDefect(type,divId){
  const L=2;
  const X=[],Y=[],Z=[],C=[];
  // 3x3x3 simple cubic lattice
  for(let i=0;i<3;i++) for(let j=0;j<3;j++) for(let k=0;k<3;k++){X.push(i*L);Y.push(j*L);Z.push(k*L); C.push('blue');}
  if(type==="vacancy"){ // remove center atom
    const idx=X.length/2|0; X.splice(idx,1); Y.splice(idx,1); Z.splice(idx,1); C.splice(idx,1);}
  if(type==="interstitial"){ // add extra atom in center
    X.push(L); Y.push(L); Z.push(L); C.push('red');}
  if(type==="impurity"){ // replace center atom color
    const idx=X.length/2|0; C[idx]='green';}
  if(type==="frenkel"){ // move center atom to interstitial
    const idx=X.length/2|0;
    X.push(X[idx]+0.5); Y.push(Y[idx]+0.5); Z.push(Z[idx]+0.5); C.push('red'); // interstitial
    C[idx]='blue';}
  if(type==="schottky"){ // remove two opposite atoms
    X.splice(0,1); Y.splice(0,1); Z.splice(0,1); C.splice(0,1);
    X.splice(X.length-1,1); Y.splice(Y.length-1,1); Z.splice(Z.length-1,1); C.splice(C.length-1,1);}
  Plotly.newPlot(divId,[{x:X,y:Y,z:Z,type:'scatter3d',mode:'markers',marker:{size:6,color:C}}],
    {title:type+' Defect',scene:{xaxis:{title:'X'},yaxis:{title:'Y'},zaxis:{title:'Z'}}});
}

plotPointDefect('vacancy','vacancyPlot');
plotPointDefect('interstitial','interstitialPlot');
plotPointDefect('impurity','impurityPlot');
plotPointDefect('frenkel','frenkelPlot');
plotPointDefect('schottky','schottkyPlot');

</script>
</body>
</html>
